#include "mbed.h"
#include "ultrasonic.h"

Serial pc(USBTX, USBRX);

int curr_dist = 0;
void
dist(int distance)
{
  // put code here to execute when the distance has changed
  if (curr_dist != distance) {
    pc.printf("Distance %d mm\r\n", distance);
    curr_dist = distance;
  }
}

ultrasonic mu(p6, p7, 0.1, 1, &dist); // Set the trigger pin to p6 and the echo
                                      // pin to p7 have updates every .1 seconds
                                      // and a timeout after 1 second, and call
                                      // dist when the distance changes

int
main()
{
  pc.baud(9600);
  pc.printf("LPC1768 restart");
  mu.startUpdates(); // start measuring the distance
  while (1) {
    // Do something else here
    mu.checkDistance(); // call checkDistance() as much as possible, as this is
                        // where
    // the class checks if dist needs to be called.
    wait(0.1);
  }
}
